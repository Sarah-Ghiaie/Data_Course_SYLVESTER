---
title: "Integrative Cardiovascular Disease Risk Prediction Using Clinical and Genetic Data"
author: "Sarah Sylvester"
output:
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

library(tidyverse)
library(caret)
library(pROC)
library(janitor)
library(patchwork)
library(scales)
library(tibble)  # for rownames_to_column
```

## Abstract

Cardiovascular diseases (CVD) are a leading global cause of mortality.
Traditional risk assessment models, such as the Framingham Risk Score,
rely solely on common clinical factors. This project investigates the
hypothesis that incorporating a **Genetic Risk Score** can enhance the
accuracy of CVD prediction beyond these traditional factors. We compare
a **Clinical-Only Model** with an **Integrative Model** (Clinical +
Genetic Risk) and evaluate performance using the Area Under the ROC
Curve (AUC).

## 1. Background & Rationale

Cardiovascular disease (CVD) encompasses a range of conditions affecting
the heart and blood vessels. Accurate risk prediction is crucial for
preventative intervention.

Traditional risk models use readily available clinical variables:

-   Continuous: age, blood pressure (`ap_hi`, `ap_lo`), cholesterol,
    glucose\
-   Categorical: smoking, alcohol use, physical activity

Advancements in genomics suggest that an individual’s inherited genetic
makeup contributes significantly to CVD susceptibility. Genetic Risk
Scores (GRS) aggregate risk from many single-nucleotide polymorphisms
(SNPs). By including a simulated `genetic_risk` score, this project
explores the potential added value of genomic information in a
predictive framework.

## 2. Data Source and Preparation

The data I used was sourced from the Kaggle **Cardiovascular Disease Dataset**, which
contains 70,000 records with clinical risk factors and a binary CVD
outcome. The original dataset can be found via a web search for “Kaggle
Cardiovascular Disease dataset.”

### 2.1 Data Loading and Cleaning

```{r data_cleaning}
cardio_data <- read.csv("cardio_train.csv", sep = ";") %>%
  clean_names() %>%
  select(-id)

cardio_data <- cardio_data %>%
  mutate(
    age_yrs = round(age / 365.25)
  ) %>%
  select(-age)

cardio_data <- cardio_data %>%
  mutate(
    cholesterol = factor(cholesterol, levels = 1:3,
                         labels = c("Normal", "Above_Normal", "High")),
    gluc        = factor(gluc, levels = 1:3,
                         labels = c("Normal", "Above_Normal", "High")),
    smoke       = factor(smoke, levels = 0:1,
                         labels = c("No", "Yes")),
    alco        = factor(alco, levels = 0:1,
                         labels = c("No", "Yes")),
    active      = factor(active, levels = 0:1,
                         labels = c("No", "Yes")),
    cardio      = factor(cardio, levels = 0:1,
                         labels = c("No", "Yes")),
    gender      = factor(gender, levels = 1:2,
                         labels = c("Female", "Male"))
  )

cardio_data <- cardio_data %>%
  filter(
    ap_hi > 60, ap_lo > 40,
    ap_hi < 250, ap_lo < 200,
    ap_hi > ap_lo
  )

clinical_df <- cardio_data %>%
  select(age_yrs, gender, ap_hi, ap_lo,
         cholesterol, gluc, smoke, alco, active, cardio)

summary(clinical_df)
```

### 2.2 Simulation of Genetic Risk Score (GRS)

```{r simulate_genetic}
set.seed(42)
n <- nrow(clinical_df)

genetic_risk_sim <- clinical_df %>%
  mutate(
    genetic_risk = sample(
      0:3, n, replace = TRUE,
      prob = c(0.4, 0.3, 0.2, 0.1)
    )
  ) %>%
  mutate(
    genetic_risk = if_else(
      cardio == "Yes",
      sample(
        0:3, n, replace = TRUE,
        prob = c(0.2, 0.3, 0.3, 0.2)
      ),
      genetic_risk
    )
  ) %>%
  mutate(genetic_risk = as.integer(genetic_risk)) %>%
  pull(genetic_risk)

final_df <- clinical_df %>%
  mutate(genetic_risk = genetic_risk_sim)

str(final_df)
```

## 3. Exploratory Data Analysis

### 3.1 Age and Genetic Risk

```{r eda_age_genetic, fig.height=8, fig.width=10}
p1 <- final_df %>%
  ggplot(aes(x = age_yrs, fill = cardio)) +
  geom_density(alpha = 0.6) +
  labs(
    title = "Age Distribution by CVD Status",
    x = "Age (years)",
    fill = "CVD"
  ) +
  theme_minimal()

p2 <- final_df %>%
  ggplot(aes(x = factor(genetic_risk), fill = cardio)) +
  geom_bar(position = "fill") +
  labs(
    title = "Genetic Risk Score by CVD Status",
    x = "Genetic Risk Score (0–3)",
    y = "Proportion",
    fill = "CVD"
  ) +
  scale_y_continuous(labels = percent) +
  theme_minimal()

p1 / p2
```

### 3.2 Blood Pressure and Cholesterol

```{r bp_chol, fig.height=6, fig.width=12}
p3 <- final_df %>%
  ggplot(aes(x = ap_hi, y = ap_lo, color = cardio)) +
  geom_point(alpha = 0.25) +
  stat_ellipse(type = "norm") +
  labs(
    title = "Blood Pressure by CVD Status",
    x = "Systolic BP (ap_hi)",
    y = "Diastolic BP (ap_lo)",
    color = "CVD"
  ) +
  scale_color_manual(values = c("No" = "dodgerblue", "Yes" = "firebrick")) +
  theme_minimal()

p4 <- final_df %>%
  ggplot(aes(x = cholesterol, fill = cardio)) +
  geom_bar(position = "dodge") +
  labs(
    title = "CVD Cases by Cholesterol Category",
    x = "Cholesterol",
    y = "Count",
    fill = "CVD"
  ) +
  theme_minimal()

p3 | p4
```

## 4. Modeling and Hypothesis Testing

```{r split}
set.seed(42)
train_index <- createDataPartition(final_df$cardio, p = 0.7, list = FALSE)
train_data  <- final_df[train_index, ]
test_data   <- final_df[-train_index, ]

train_control <- trainControl(
  method = "cv",
  number = 5,
  classProbs = TRUE,
  summaryFunction = twoClassSummary,
  savePredictions = "final"
)
```

```{r train_models}
clinical_formula <- cardio ~ age_yrs + gender + ap_hi + ap_lo +
  cholesterol + gluc + smoke + alco + active

integrative_formula <- cardio ~ age_yrs + gender + ap_hi + ap_lo +
  cholesterol + gluc + smoke + alco + active + genetic_risk

model_clinical <- train(
  clinical_formula,
  data      = train_data,
  method    = "glm",
  family    = "binomial",
  trControl = train_control,
  metric    = "ROC"
)

model_integrative <- train(
  integrative_formula,
  data      = train_data,
  method    = "glm",
  family    = "binomial",
  trControl = train_control,
  metric    = "ROC"
)

model_clinical$results$ROC
model_integrative$results$ROC
```

```{r roc_compare, fig.height=6, fig.width=10}
pred_clinical_prob <- predict(
  model_clinical, newdata = test_data,
  type = "prob"
)[, "Yes"]

pred_integrative_prob <- predict(
  model_integrative, newdata = test_data,
  type = "prob"
)[, "Yes"]

roc_clinical    <- roc(test_data$cardio, pred_clinical_prob)
roc_integrative <- roc(test_data$cardio, pred_integrative_prob)

auc_clinical    <- auc(roc_clinical)
auc_integrative <- auc(roc_integrative)
auc_diff        <- as.numeric(auc_integrative - auc_clinical)

ggroc(
  list(
    "Clinical-Only" = roc_clinical,
    "Integrative"   = roc_integrative
  ),
  legacy.axes = TRUE
) +
  geom_abline(intercept = 1, slope = 1,
              linetype = "dashed", color = "gray50") +
  labs(
    title = "ROC Curves: Clinical vs Integrative Models",
    x = "False Positive Rate (1 − Specificity)",
    y = "True Positive Rate",
    color = "Model"
  ) +
  theme_minimal() +
  annotate(
    "text",
    x = 0.65, y = 0.25,
    label = paste0(
      "Clinical AUC:    ", round(auc_clinical, 4),
      "\nIntegrative AUC: ", round(auc_integrative, 4),
      "\nDifference:      ", round(auc_diff, 4)
    ),
    hjust = 0
  )
```

| Model         | AUC (Test Set)                | Difference from Clinical |
|:--------------|:------------------------------|:-------------------------|
| Clinical-Only | `r round(auc_clinical, 4)`    | –                        |
| Integrative   | `r round(auc_integrative, 4)` | `r round(auc_diff, 4)`   |

```{r varimp, fig.height=7, fig.width=8}
importance <- varImp(model_integrative, scale = FALSE)

importance_df <- importance$importance %>%
  as.data.frame() %>%
  rownames_to_column("Variable") %>%
  arrange(desc(Overall))

ggplot(importance_df,
       aes(x = reorder(Variable, Overall), y = Overall)) +
  geom_col(fill = "darkcyan") +
  coord_flip() +
  labs(
    title = "Variable Importance in Integrative Model",
    x = "",
    y = "Importance Score"
  ) +
  theme_minimal()
```

## 5. Conclusion

The integrative model shows a modest improvement in AUC compared with
the clinical‑only model, suggesting that genetic information—even in
simplified, simulated form—can add incremental predictive value. Age and
blood pressure remain dominant predictors, but the genetic risk score
also contributes meaningfully to model performance, illustrating the
potential of combining clinical and genomic data in cardiovascular risk
assessment.

